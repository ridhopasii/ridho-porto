<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <style type="text/tailwindcss">
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0a0a0a; color: white; }
        .sidebar-link { @apply flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition-all; }
        .sidebar-link.active { @apply bg-teal-500/10 text-teal-400; }
        input, textarea, select { @apply w-full bg-black/20 border border-white/10 rounded-lg px-4 py-3 focus:outline-none focus:border-teal-500 transition-colors text-white; }
        label { @apply block text-sm text-gray-400 mb-1; }
    </style>
</head>

<body class="flex min-h-screen">
    <%- include('../partials/sidebar', { path: '/admin/profile' }) %>

        <main class="flex-1 ml-64 p-8">
            <%- include('../partials/header', { title: 'Edit Profile' }) %>

                <% if (locals.error) { %>
                    <div class="bg-red-500/10 border border-red-500/20 text-red-500 p-4 rounded-xl mb-6">
                        <%= error %>
                    </div>
                    <% } %>

                        <% if (typeof req !=='undefined' && req.query.success) { %>
                            <div class="bg-green-500/10 border border-green-500/20 text-green-500 p-4 rounded-xl mb-6">
                                Profile updated successfully!
                            </div>
                            <% } %>

                                <div class="max-w-4xl mx-auto">
                                    <div class="bg-white/5 border border-white/10 rounded-2xl p-8">
                                        <form action="/admin/profile" method="POST" enctype="multipart/form-data"
                                            class="space-y-8">
                                            <!-- Personal Info -->
                                            <div>
                                                <h3
                                                    class="text-lg font-bold font-outfit mb-4 text-teal-400 border-b border-white/10 pb-2">
                                                    Personal Information</h3>
                                                <div class="grid grid-cols-2 gap-6">
                                                    <div>
                                                        <label>Full Name</label>
                                                        <input type="text" name="fullName"
                                                            value="<%= profile ? profile.fullName : '' %>" required>
                                                    </div>
                                                    <div>
                                                        <label>Title / Job</label>
                                                        <input type="text" name="title"
                                                            value="<%= profile ? profile.title : '' %>" required>
                                                    </div>
                                                    <div class="col-span-2">
                                                        <label>Bio</label>
                                                        <textarea name="bio"
                                                            rows="3"><%= profile ? profile.bio : '' %></textarea>
                                                    </div>
                                                    <div>
                                                        <label>Location</label>
                                                        <input type="text" name="location"
                                                            value="<%= profile ? profile.location : '' %>">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Contact Info -->
                                            <div>
                                                <h3
                                                    class="text-lg font-bold font-outfit mb-4 text-teal-400 border-b border-white/10 pb-2">
                                                    Contact & Links</h3>
                                                <div class="grid grid-cols-2 gap-6">
                                                    <div>
                                                        <label>Email</label>
                                                        <input type="email" name="email"
                                                            value="<%= profile ? profile.email : '' %>">
                                                    </div>
                                                    <div>
                                                        <label>Phone</label>
                                                        <input type="text" name="phone"
                                                            value="<%= profile ? profile.phone : '' %>">
                                                    </div>
                                                    <div>
                                                        <label>WhatsApp URL</label>
                                                        <input type="url" name="whatsappUrl"
                                                            value="<%= profile ? profile.whatsappUrl : '' %>">
                                                    </div>
                                                    <div>
                                                        <label>CV Link (Google Drive / Direct URL)</label>
                                                        <input type="url" name="cvLink"
                                                            value="<%= profile ? profile.cvLink : '' %>">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Images -->
                                            <div>
                                                <h3
                                                    class="text-lg font-bold font-outfit mb-4 text-teal-400 border-b border-white/10 pb-2">
                                                    Images
                                                </h3>
                                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

                                                    <!-- Avatar -->
                                                    <div class="bg-white/5 border border-white/10 rounded-xl p-4">
                                                        <label
                                                            class="block mb-2 font-medium text-teal-400">Avatar</label>
                                                        <% if (profile && profile.avatarUrl) { %>
                                                            <div class="mb-4">
                                                                <img src="<%= profile.avatarUrl %>"
                                                                    class="w-24 h-24 rounded-full object-cover border-2 border-white/10 mx-auto">
                                                            </div>
                                                            <% } %>

                                                                <div class="flex flex-col gap-3">
                                                                    <% const isAvatarUrl=profile && profile.avatarUrl &&
                                                                        !profile.avatarUrl.startsWith('/uploads/'); %>
                                                                        <div
                                                                            class="flex gap-2 text-xs justify-center bg-black/40 rounded-lg p-1">
                                                                            <label
                                                                                class="flex-1 text-center cursor-pointer py-1 px-2 rounded hover:bg-white/10 has-[:checked]:bg-teal-500/20 has-[:checked]:text-teal-400">
                                                                                <input type="radio" name="avatarSource"
                                                                                    value="file" <%=!isAvatarUrl
                                                                                    ? 'checked' : '' %> class="hidden"
                                                                                onchange="toggleProfileImageInput('avatar',
                                                                                this.value)">
                                                                                File
                                                                            </label>
                                                                            <label
                                                                                class="flex-1 text-center cursor-pointer py-1 px-2 rounded hover:bg-white/10 has-[:checked]:bg-teal-500/20 has-[:checked]:text-teal-400">
                                                                                <input type="radio" name="avatarSource"
                                                                                    value="url" <%=isAvatarUrl
                                                                                    ? 'checked' : '' %> class="hidden"
                                                                                onchange="toggleProfileImageInput('avatar',
                                                                                this.value)">
                                                                                URL
                                                                            </label>
                                                                        </div>

                                                                        <div id="avatarFileInput"
                                                                            class="<%= isAvatarUrl ? 'hidden' : '' %>">
                                                                            <input type="file" name="avatarUrl"
                                                                                accept="image/*"
                                                                                class="w-full text-xs text-slate-400 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-teal-500/10 file:text-teal-400 hover:file:bg-teal-500/20">
                                                                        </div>
                                                                        <div id="avatarUrlInput"
                                                                            class="<%= !isAvatarUrl ? 'hidden' : '' %>">
                                                                            <input type="url" name="avatarUrlUrl"
                                                                                value="<%= isAvatarUrl ? profile.avatarUrl : '' %>"
                                                                                placeholder="https://..."
                                                                                class="w-full text-sm bg-black/40 border border-white/10 rounded-lg px-3 py-2 focus:outline-none focus:border-teal-500 text-white">
                                                                        </div>
                                                                </div>
                                                    </div>

                                                    <!-- Hero Image -->
                                                    <div class="bg-white/5 border border-white/10 rounded-xl p-4">
                                                        <label class="block mb-2 font-medium text-teal-400">Hero
                                                            Image</label>
                                                        <% if (profile && profile.heroImage) { %>
                                                            <div class="mb-4">
                                                                <img src="<%= profile.heroImage %>"
                                                                    class="w-full h-24 rounded-lg object-cover border border-white/10">
                                                            </div>
                                                            <% } %>

                                                                <div class="flex flex-col gap-3">
                                                                    <% const isHeroUrl=profile && profile.heroImage &&
                                                                        !profile.heroImage.startsWith('/uploads/'); %>
                                                                        <div
                                                                            class="flex gap-2 text-xs justify-center bg-black/40 rounded-lg p-1">
                                                                            <label
                                                                                class="flex-1 text-center cursor-pointer py-1 px-2 rounded hover:bg-white/10 has-[:checked]:bg-teal-500/20 has-[:checked]:text-teal-400">
                                                                                <input type="radio" name="heroSource"
                                                                                    value="file" <%=!isHeroUrl
                                                                                    ? 'checked' : '' %> class="hidden"
                                                                                onchange="toggleProfileImageInput('hero',
                                                                                this.value)">
                                                                                File
                                                                            </label>
                                                                            <label
                                                                                class="flex-1 text-center cursor-pointer py-1 px-2 rounded hover:bg-white/10 has-[:checked]:bg-teal-500/20 has-[:checked]:text-teal-400">
                                                                                <input type="radio" name="heroSource"
                                                                                    value="url" <%=isHeroUrl ? 'checked'
                                                                                    : '' %> class="hidden"
                                                                                onchange="toggleProfileImageInput('hero',
                                                                                this.value)">
                                                                                URL
                                                                            </label>
                                                                        </div>

                                                                        <div id="heroFileInput"
                                                                            class="<%= isHeroUrl ? 'hidden' : '' %>">
                                                                            <input type="file" name="heroImage"
                                                                                accept="image/*"
                                                                                class="w-full text-xs text-slate-400 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-teal-500/10 file:text-teal-400 hover:file:bg-teal-500/20">
                                                                        </div>
                                                                        <div id="heroUrlInput"
                                                                            class="<%= !isHeroUrl ? 'hidden' : '' %>">
                                                                            <input type="url" name="heroImageUrl"
                                                                                value="<%= isHeroUrl ? profile.heroImage : '' %>"
                                                                                placeholder="https://..."
                                                                                class="w-full text-sm bg-black/40 border border-white/10 rounded-lg px-3 py-2 focus:outline-none focus:border-teal-500 text-white">
                                                                        </div>
                                                                </div>
                                                    </div>

                                                    <!-- About Image -->
                                                    <div class="bg-white/5 border border-white/10 rounded-xl p-4">
                                                        <label class="block mb-2 font-medium text-teal-400">About
                                                            Image</label>
                                                        <% if (profile && profile.aboutImage) { %>
                                                            <div class="mb-4">
                                                                <img src="<%= profile.aboutImage %>"
                                                                    class="w-full h-24 rounded-lg object-cover border border-white/10">
                                                            </div>
                                                            <% } %>

                                                                <div class="flex flex-col gap-3">
                                                                    <% const isAboutUrl=profile && profile.aboutImage &&
                                                                        !profile.aboutImage.startsWith('/uploads/'); %>
                                                                        <div
                                                                            class="flex gap-2 text-xs justify-center bg-black/40 rounded-lg p-1">
                                                                            <label
                                                                                class="flex-1 text-center cursor-pointer py-1 px-2 rounded hover:bg-white/10 has-[:checked]:bg-teal-500/20 has-[:checked]:text-teal-400">
                                                                                <input type="radio" name="aboutSource"
                                                                                    value="file" <%=!isAboutUrl
                                                                                    ? 'checked' : '' %> class="hidden"
                                                                                onchange="toggleProfileImageInput('about',
                                                                                this.value)">
                                                                                File
                                                                            </label>
                                                                            <label
                                                                                class="flex-1 text-center cursor-pointer py-1 px-2 rounded hover:bg-white/10 has-[:checked]:bg-teal-500/20 has-[:checked]:text-teal-400">
                                                                                <input type="radio" name="aboutSource"
                                                                                    value="url" <%=isAboutUrl
                                                                                    ? 'checked' : '' %> class="hidden"
                                                                                onchange="toggleProfileImageInput('about',
                                                                                this.value)">
                                                                                URL
                                                                            </label>
                                                                        </div>

                                                                        <div id="aboutFileInput"
                                                                            class="<%= isAboutUrl ? 'hidden' : '' %>">
                                                                            <input type="file" name="aboutImage"
                                                                                accept="image/*"
                                                                                class="w-full text-xs text-slate-400 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-teal-500/10 file:text-teal-400 hover:file:bg-teal-500/20">
                                                                        </div>
                                                                        <div id="aboutUrlInput"
                                                                            class="<%= !isAboutUrl ? 'hidden' : '' %>">
                                                                            <input type="url" name="aboutImageUrl"
                                                                                value="<%= isAboutUrl ? profile.aboutImage : '' %>"
                                                                                placeholder="https://..."
                                                                                class="w-full text-sm bg-black/40 border border-white/10 rounded-lg px-3 py-2 focus:outline-none focus:border-teal-500 text-white">
                                                                        </div>
                                                                </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <script>
                                                function toggleProfileImageInput(type, source) {
                                                    const fileContainer = document.getElementById(type + 'FileInput');
                                                    const urlContainer = document.getElementById(type + 'UrlInput');
                                                    const fileInput = fileContainer.querySelector('input');
                                                    const urlInput = urlContainer.querySelector('input');

                                                    if (source === 'file') {
                                                        fileContainer.classList.remove('hidden');
                                                        urlContainer.classList.add('hidden');
                                                        urlInput.value = '';
                                                    } else {
                                                        fileContainer.classList.add('hidden');
                                                        urlContainer.classList.remove('hidden');
                                                        fileInput.value = '';
                                                    }
                                                }
                                            </script>

                                            <div class="pt-4 border-t border-white/10">
                                                <button type="submit"
                                                    class="w-full bg-teal-500 hover:bg-teal-600 text-black font-bold py-3 rounded-lg transition-colors transform hover:scale-[1.01]">
                                                    Save Changes
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
        </main>
        <script>lucide.createIcons();</script>
</body>

</html>