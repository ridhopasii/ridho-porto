<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= skill ? 'Edit' : 'Add' %> Skill - Admin Panel
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <style type="text/tailwindcss">
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0a0a0a; color: white; }
        .sidebar-link { @apply flex items-center gap-3 px-4 py-3 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition-all; }
        .sidebar-link.active { @apply bg-teal-500/10 text-teal-400; }
        input, textarea, select { @apply w-full bg-black/20 border border-white/10 rounded-lg px-4 py-3 focus:outline-none focus:border-teal-500 transition-colors text-white; }
        label { @apply block text-sm text-gray-400 mb-1; }
    </style>
</head>

<body class="flex min-h-screen">
    <%- include('../partials/sidebar', { path: '/admin/skills' }) %>

        <main class="flex-1 ml-64 p-8">
            <%- include('../partials/header', { title: skill ? 'Edit Skill' : 'Add Skill' }) %>

                <div class="max-w-2xl mx-auto">
                    <div class="bg-white/5 border border-white/10 rounded-2xl p-8">
                        <form action="/admin/skills<%= skill ? '/edit/' + skill.id : '/create' %>" method="POST"
                            enctype="multipart/form-data" class="space-y-6">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label>Skill Name</label>
                                    <input type="text" name="name" value="<%= skill ? skill.name : '' %>" required>
                                </div>
                                <div>
                                    <label>Category</label>
                                    <select name="category" required>
                                        <% const categories=['Application', 'Device' , 'Language' , 'Framework' , 'Tool'
                                            ]; %>
                                            <% categories.forEach(cat=> { %>
                                                <option value="<%= cat %>" <%=skill && skill.category===cat ? 'selected'
                                                    : '' %> class="bg-black text-white"><%= cat %>
                                                </option>
                                                <% }) %>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label>Proficiency (%)</label>
                                <input type="number" name="percentage" min="0" max="100"
                                    value="<%= skill ? skill.percentage : 80 %>" required>
                            </div>

                            <div class="space-y-4">
                                <label class="text-sm font-medium text-gray-400">Icon Type</label>
                                <div class="flex gap-4" id="iconTypeToggle">
                                    <label class="flex-1 relative group cursor-pointer">
                                        <input type="radio" name="iconType" value="name" class="sr-only peer" <%=!skill
                                            || (skill && !skill.icon.startsWith('/')) ? 'checked' : '' %>>
                                        <div
                                            class="flex items-center justify-center gap-3 p-4 bg-black/40 border border-white/10 rounded-xl peer-checked:border-teal-500 peer-checked:bg-teal-500/10 transition-all hover:bg-white/5 group-hover:border-white/20">
                                            <i data-lucide="hash"
                                                class="w-5 h-5 text-gray-500 peer-checked:text-teal-400"></i>
                                            <span
                                                class="text-sm font-semibold text-gray-400 peer-checked:text-white">Lucide
                                                Icon</span>
                                        </div>
                                    </label>
                                    <label class="flex-1 relative group cursor-pointer">
                                        <input type="radio" name="iconType" value="image" class="sr-only peer" <%=skill
                                            && skill.icon.startsWith('/') ? 'checked' : '' %>>
                                        <div
                                            class="flex items-center justify-center gap-3 p-4 bg-black/40 border border-white/10 rounded-xl peer-checked:border-teal-500 peer-checked:bg-teal-500/10 transition-all hover:bg-white/5 group-hover:border-white/20">
                                            <i data-lucide="image"
                                                class="w-5 h-5 text-gray-500 peer-checked:text-teal-400"></i>
                                            <span
                                                class="text-sm font-semibold text-gray-400 peer-checked:text-white">Custom
                                                Image</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div id="iconNameInput" class="<%= skill && skill.icon.startsWith('/') ? 'hidden' : '' %>">
                                <label>Icon Name (from Lucide.dev)</label>
                                <input type="text" name="iconName"
                                    value="<%= skill && !skill.icon.startsWith('/') ? skill.icon : '' %>"
                                    placeholder="e.g. code, figman, pen-tool">
                                <p class="text-xs text-gray-500 mt-1">See <a href="https://lucide.dev/icons"
                                        target="_blank" class="text-teal-400">Lucide Icons</a></p>
                            </div>

                            <div id="iconImageInput"
                                class="<%= !skill || (skill && !skill.icon.startsWith('/')) ? 'hidden' : '' %>">
                                <div class="space-y-4">
                                    <label class="text-sm font-medium text-gray-400">Icon Image</label>

                                    <% if (skill && skill.icon && skill.icon.startsWith('/')) { %>
                                        <div class="group relative inline-block">
                                            <img src="<%= skill.icon %>" alt="Current"
                                                class="w-20 h-20 object-contain bg-white/5 rounded-xl p-3 border-2 border-white/10 group-hover:border-teal-500/50 transition-all shadow-2xl">
                                            <div
                                                class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity rounded-xl flex items-center justify-center">
                                                <span
                                                    class="text-[8px] uppercase tracking-widest font-bold">Current</span>
                                            </div>
                                        </div>
                                        <% } %>

                                            <div
                                                class="bg-black/40 border border-white/5 rounded-2xl p-6 backdrop-blur-sm">
                                                <% const isUrl=skill && skill.icon && skill.icon.startsWith('http'); %>

                                                    <!-- Modern Segmented Toggle -->
                                                    <div
                                                        class="inline-flex p-1 bg-white/5 rounded-xl mb-6 relative w-full sm:w-auto">
                                                        <div id="toggleHighlight"
                                                            class="absolute h-[calc(100%-8px)] transition-all duration-300 ease-out bg-teal-500 rounded-lg shadow-[0_0_20px_rgba(20,184,166,0.3)]">
                                                        </div>

                                                        <label
                                                            class="relative flex-1 sm:w-32 py-2 text-center cursor-pointer z-10">
                                                            <input type="radio" name="imageSource" value="file"
                                                                <%=!isUrl ? 'checked' : '' %> class="sr-only"
                                                            onchange="updateToggleUI('file')">
                                                            <span
                                                                class="text-sm font-semibold transition-colors duration-300 <%= !isUrl ? 'text-black' : 'text-gray-400' %>">Upload
                                                                File</span>
                                                        </label>

                                                        <label
                                                            class="relative flex-1 sm:w-32 py-2 text-center cursor-pointer z-10">
                                                            <input type="radio" name="imageSource" value="url" <%=isUrl
                                                                ? 'checked' : '' %> class="sr-only"
                                                            onchange="updateToggleUI('url')">
                                                            <span
                                                                class="text-sm font-semibold transition-colors duration-300 <%= isUrl ? 'text-black' : 'text-gray-400' %>">Image
                                                                URL</span>
                                                        </label>
                                                    </div>

                                                    <div class="space-y-4">
                                                        <div id="fileInputContainer"
                                                            class="hidden animate-in fade-in slide-in-from-top-2 duration-300">
                                                            <div
                                                                class="border-2 border-dashed border-white/10 hover:border-teal-500/30 rounded-xl p-8 text-center transition-colors group">
                                                                <input type="file" name="image" id="fileInput"
                                                                    accept="image/*" class="sr-only">
                                                                <label for="fileInput" class="cursor-pointer">
                                                                    <div
                                                                        class="bg-teal-500/10 w-10 h-10 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                                                                        <i data-lucide="upload"
                                                                            class="w-5 h-5 text-teal-400"></i>
                                                                    </div>
                                                                    <p class="text-xs text-gray-300 font-medium">
                                                                        Upload Icon</p>
                                                                </label>
                                                            </div>
                                                        </div>

                                                        <div id="urlInputContainer"
                                                            class="hidden animate-in fade-in slide-in-from-top-2 duration-300">
                                                            <div class="relative group">
                                                                <div
                                                                    class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-500 group-focus-within:text-teal-400 transition-colors">
                                                                    <i data-lucide="link" class="w-4 h-4"></i>
                                                                </div>
                                                                <input type="url" name="iconUrl"
                                                                    value="<%= isUrl ? skill.icon : '' %>"
                                                                    placeholder="https://example.com/icon.png"
                                                                    class="pl-11 pr-4 py-3 bg-black/40 border border-white/10 rounded-xl focus:ring-2 focus:ring-teal-500/20 w-full outline-none transition-all text-sm">
                                                            </div>
                                                        </div>
                                                    </div>
                                            </div>
                                </div>
                            </div>

                            <script>
                                function updateToggleUI(source) {
                                    const fileContainer = document.getElementById('fileInputContainer');
                                    const urlContainer = document.getElementById('urlInputContainer');
                                    const highlight = document.getElementById('toggleHighlight');
                                    const labels = document.querySelectorAll('#iconImageInput [name="imageSource"] + span');

                                    if (source === 'file') {
                                        fileContainer.classList.remove('hidden');
                                        urlContainer.classList.add('hidden');
                                        if (highlight) {
                                            highlight.style.left = '4px';
                                            highlight.style.width = 'calc(50% - 4px)';
                                        }
                                        if (labels.length >= 2) {
                                            labels[0].classList.add('text-black');
                                            labels[0].classList.remove('text-gray-400');
                                            labels[1].classList.add('text-gray-400');
                                            labels[1].classList.remove('text-black');
                                        }
                                    } else {
                                        fileContainer.classList.add('hidden');
                                        urlContainer.classList.remove('hidden');
                                        if (highlight) {
                                            highlight.style.left = '50%';
                                            highlight.style.width = 'calc(50% - 4px)';
                                        }
                                        if (labels.length >= 2) {
                                            labels[1].classList.add('text-black');
                                            labels[1].classList.remove('text-gray-400');
                                            labels[0].classList.add('text-gray-400');
                                            labels[0].classList.remove('text-black');
                                        }
                                    }
                                }

                                // Initialize image toggle on load if image type is selected
                                window.addEventListener('load', function () {
                                    const checkedSource = document.querySelector('#iconImageInput input[name="imageSource"]:checked');
                                    if (checkedSource) updateToggleUI(checkedSource.value);
                                    else updateToggleUI('file');
                                });
                            </script>
                    </div>

                    <div class="flex gap-4 pt-4">
                        <button type="submit"
                            class="flex-1 bg-teal-500 hover:bg-teal-600 text-black font-bold py-3 rounded-lg transition-colors">
                            <%= skill ? 'Update Skill' : 'Add Skill' %>
                        </button>
                        <a href="/admin/skills"
                            class="flex-1 bg-white/10 hover:bg-white/20 text-white font-bold py-3 rounded-lg text-center transition-colors">
                            Cancel
                        </a>
                    </div>
                    </form>
                </div>
                </div>
        </main>
        <script>
            lucide.createIcons();

            const radios = document.querySelectorAll('input[name="iconType"]');
            const nameInput = document.getElementById('iconNameInput');
            const imageInput = document.getElementById('iconImageInput');

            radios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    if (e.target.value === 'name') {
                        nameInput.classList.remove('hidden');
                        imageInput.classList.add('hidden');
                    } else {
                        nameInput.classList.add('hidden');
                        imageInput.classList.remove('hidden');
                        // Ensure toggle UI is correct when switching to image mode
                        const checkedSource = document.querySelector('#iconImageInput input[name="imageSource"]:checked');
                        if (checkedSource) updateToggleUI(checkedSource.value);
                    }
                });
            });
        </script>
</body>

</html>